#include "serialize.h"

// Функция сериализации вектора пар "ключ-значение" в строку
std::string serialize(std::vector<std::pair<std::string, std::string>> data)
{
    // Инициализируем пустую строку для хранения результата сериализации
    std::string result = "";

    // Проходим по всем элементам вектора данных
    for (auto elem : data) {
        // Для каждой пары "ключ-значение" формируем строку в формате "ключ:значение\n"
        // elem.first содержит ключ, elem.second содержит значение
        result += elem.first + ":" + elem.second + "\n";
    }

    // Удаляем последний символ перевода строки из результата
    // result.rfind("\n") находит позицию последнего символа '\n'
    // result.substr(0, pos) возвращает подстроку от начала до этой позиции
    result = result.substr(0, result.rfind("\n"));

    // Возвращаем полученную сериализованную строку
    return result;
}

// Функция десериализации строки в вектор пар "ключ-значение"
std::vector<std::pair<std::string, std::string>> unserialize(std::string data)
{
    // Создаем пустой вектор для хранения результата десериализации
    std::vector<std::pair<std::string, std::string>> result;
    // В оригинальном коде был закомментированный код: //auto temp = data;

    // Цикл продолжается, пока строка данных не станет пустой
    while (!data.empty()) {
        // Находим позицию первого символа перевода строки '\n'
        // Это разделитель между элементами данных
        size_t elemEnd = data.find("\n");

        // Извлекаем подстроку от начала до символа перевода строки
        // Это один элемент данных в формате "ключ:значение"
        std::string elem = data.substr(0, elemEnd);

        // Находим позицию разделителя ":" внутри элемента
        size_t delim = elem.find(":");

        // Извлекаем ключ - подстроку от начала до разделителя ":"
        std::string key = elem.substr(0, delim);

        // Извлекаем значение - подстроку после разделителя ":" до конца строки
        // delim + 1 - начинаем с символа после разделителя ":"
        std::string value = elem.substr(delim + 1);

        // Добавляем пару "ключ-значение" в результирующий вектор
        // Используем конструктор пары с двумя аргументами
        result.push_back(std::pair(key, value));

        // Обрезаем исходную строку, удаляя обработанный элемент и символ '\n'
        // elemEnd + 1 - начинаем с символа после '\n'
        data = data.substr(elemEnd + 1);
    }

    // Возвращаем вектор с десериализованными данными
    return result;
}